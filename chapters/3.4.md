### 3.4 项目实施
经过上一个小节，我们对项目进行了细致的需求分析。相信读者对该问卷系统要实现的功能有了比较清晰的认识。接下来，我们要开始正式的编码工作，使用Angular2实现整个问卷系统。在开始之前，我们需要介绍一下项目中使用到的相关技术或工具，以及如何进行项目配置和启动。然后我们对系统进行组件化的拆解、数据建模以及每个页面和组件开发。
#### 3.4.1 使用的技术
项目中使用到的相关技术如下：

 - angular2-seed
 
angular2-seed是一个angular2的脚手架。脚手架是基于某种技术搭建项目的基本代码骨架。脚手架本身不包含任何跟业务逻辑相关的代码，它只是一个构建项目的框架，但他基本上包含了所有具体应用中需要使用到的核心库或依赖。可以通俗的理解为动物的骨骼，在骨骼之上的肌肉就是我们需要编写的业务代码。angular2-seed为我们快速构建基于angular2的应用提供了极大的便利，免去了很多繁杂的初始化搭建工作。

angular2-seed提供了很多非常好的特性，其中有几项比较重要。由于我们使用TypeScript进行angular2开发（官方推荐），它使用gulp配合gulp-typescript插件进行自动编译。同时，也提供了开发模式和生产模式的两种环境构建。它还支持开发模式下的自动热加载，通过监听文件的变化，实现文件修改时自动重新加载页面，使我们在开发的时候的任何修改都能及时反映到页面上，不需要反复的进行页面刷新。angular2-seed还集成了Jasmine和Karma，同时还包含了单元测试代码覆盖率检测工具istanbul，我们只需要关心测试用例的编写。

angular2-seed使用也非常简单，只需要三步。

```javascript
//1. 从github上克隆angular2-seed到本地
git clone --depth 1 https://github.com/mgechev/angular2-seed.git

//2. 安装依赖包
cd angular2-seed
npm install

//3. 启动
npm start

//如果只想进行开发模式和生产模式的构建，只需要分别执行npm run build.dev和npm run build.prod即可

```

执行npm start后，浏览器会自动打开http://localhost:5555，表明angular2-seed安装成功。我们会基于此脚手架来完成问卷系统的开发。

 - angular2-bootstrap

可能大部分前端开发工程师都使用或者了解过bootstrap，它是Twitter推出的一款前端UI框架，使用bootstrap可以快速的开发漂亮的网页。angular2-bootstrap是一些angular2的指令集合，提供了类似bootstrap的漂亮的UI， 例如轮播图、警告框等。
 
 
 - json-server

json-server是一个简易的node server，用来模拟后端服务器。在真实的应用场景中，我们通常会使用express+mongodb或者php+mysql等来作为后端http服务，提供API与前端进行通信和数据持久化。但在本项目中，我们的重点是通过项目实例的方式介绍angular2的应用，因此后端的开发我们尽量使用最简化的方式。json-server就是用来模拟server提供api服务的。它没有实际的数据库，采用纯json文本的方式保持数据，通过很少的代码就能搭建一个REST API server。关于json-server的具体用法，读者可以参考官方github上的文档，这里不详细介绍。
 - rxjs
 - immutable.js


##### 3.4.2 配置 & 启动

- 环境配置：介绍基础的依赖，，后台的数据存储方式以及配置后台接口调用相关的知识。
- 启动步骤：分为前后台，后台启动步骤简单说明下json-server的启动方式，前台简单说明下gulp的使用，以及通过gulp启动前端代理服务器的方式等。

##### 3.4.3 组件拆解

- 根据上一节的产品设计，绘制项目的组件树。（组件树截图： 9-9）
- 通过组件树完成对项目各个模块组件的拆解，针对每个组件的功能做详细的说明。主要包括：

	- 根组件
	- 首页和帮助页组件
	- 问卷列表组件
	- 问卷组件
	- 问题组件
	- 用户管理组件
	- 问卷大纲组件
	- 问卷详情组件

##### 3.4.4 数据建模

本例中主要涉及到两类核心的数据模型，问卷模型和问题模型。在正式开始组件的开发之前，将首先介绍下它们包含的属性及属性的含义。

###### 问卷模型

问卷模型是描述一个调查问卷的基本数据结构，包含了问卷所有的核心要素。完整的数据结构定义如下：

	export interface QuestionnaireModel{
  	  id?:number;	//问卷ID
  	  title:string;	//问卷标题
   	  owner:number;	//作者ID
	  starter:string;	//开始问候语
  	  ending:string;	//结束问候语
	  state:QuestionnaireState;	//问卷状态
	  questionList: QuestionModel[];	//问题列表
	  createDate?:string;	//创建日期
 	}

 这里我们使用了接口去定义一个问卷模型，接下来将针对这些属性做逐一说明。

 id的类型是数值型，是问卷的唯一性标识，属性后?号标识在使用接口的时候，该属性是非必须的，因为在问卷的id是在问卷保存的时候由后台自动生成的，所以在创建问卷阶段问卷的id是未知的。

 owner是问卷作者的ID标识，可以根据该标识获取到问卷创建者的详细信息。

 state是指问卷当前所处的状态，QuestionnaireState是一个枚举类型，每个枚举项分别对应着问卷的创建状态、编辑状态、发布回收状态和完成状态。其中发布回收状态表示问卷已经对外发布，处于回收问卷填写信息阶段，完成状态表示问卷已经结束回收，调查通道也已关闭。问卷状态的定义如下：

	export const enum QuestionnaireState{
  	  Create,
	  Edit,
 	  Published,
  	  Finished
	}

 title、starter、ending以及创建时间都是简单的字符串类型，分别表示问卷的标题、开始问候语、结束问候语和问卷创建日期。

questionList是构成问卷的问题列表，是一个数组类型。每个数组元素对应一个问题，QuestionModel是问题的类型定义，接下来就针对此类型做详细说明。

###### 问题模型

问题是构建一个问卷的基础，问卷模型详细的描述了一个完整的问题所需的基本要素。问卷的数据结构定义如下：

	export interface QuestionModel{
  	  title:string;	//问题标题（描述）
  	  type:QuestionType;	//问题类型
  	  options?:any[];	//答案选项
  	  answer:any;	//问题答案
	}

和问卷模型类似，我们同样使用接口去定义一个问题模型。

title是问题的标题，类型是字符串类型，用来描述一个问题。

type属性标识问题的类型，或者可以说是问题控件的类型，这里使用了枚举类型QuestionType作为type的数据类型。目前程序支持的问题类型主要有文本题、单选题、多选题和分值题四类。QuestionType的枚举定义如下：

	export const enum QuestionType{
	  Text,
	  SingleSelect,
	  MultiSelect,
	  Score
	}

options属性对应着答案的选项，因为不是所有的问题都具备可选择的答案选项，所以该属性是一个可选属性。在我们的例子中，单选题和多选题都具有可选的答案选型，而文本题和分值题则无此属性。这里需要特别说明的是为了方便扩展，我们并没有为options属性设置特定的数据类型，而是使用了any关键字标识。
