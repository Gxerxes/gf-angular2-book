### 9.4 用户管理功能
前面已经提到了，用户管理部分是系统最基础的功能之一，在很多系统中都是必不可少的一部分，具有一定的代表性。同时，用户管理涉及到的表单操作也是项目实战中很有代表性的功能之一。

从功能上来讲，用户管理可以用户注册、用户登录、管理员对用户的管理，其中管理员对用户的管理也是权限管理的一部分，与本书要讲的内容没有太大关联，在这里就不展开来讲了。下面将主要以用户注册来说明表单的结构、表单的校验等问题。

#### 用户注册组件
注册就是要解决如何在系统里面标识一个用户的问题，最简单也是最常用的办法就是让用户先注册，并提交部分身份信息。根据项目规范，注册应该是一个独立的组件，在前面的 2.2 节已经介绍了如何创建一个组件，这里就略过这部分内容。那么，首先来看一下组件的代码目录结构：
```
.
├── index.ts
├── reg.component.css
├── reg.component.html
├── reg.component.ts
├── reg.component.e2e-spec.ts
├── reg.component.spec.ts
├── user.service.ts
├── user.ts
└── user.validators.ts
```

整个组件是一个整体，这里分别讲一下各个文件的作用以及相互是怎么工作的。

+ index.ts

这是组件的输出，在这里只是简单的一句：
```js
export * from './reg.component';
```
外面的组件想要引用是时候只需要 `import` 就完成了对组件的引用
```js
import { RegComponent } from './+reg/index';
```

+ reg.component.css

组件的样式，这里就不展开来讲了。

+ reg.component.html
包括组件的 HTML 结构、相关的指令、事件绑定等，是 `Angluar` 非常重要的一部分，后面会具体展开来讲。

+ reg.component.ts

这是组件的逻辑部分，通过 `@Component` 可以将 `css` 和 `html` 与其关联起来：
```js
@Component({
  moduleId: module.id,
  selector: 'reg',
  providers: [UserService],
  templateUrl: 'reg.component.html',
  styleUrls: ['reg.component.css'],
  directives: [ROUTER_DIRECTIVES]
});
```

+ reg.component.e2e-spec.ts 和 reg.component.spec.ts

这是组件的测试用例，这部分可有可无，但是作为一个有追求的程序员，测试用例还是要写的。

+ user.ts

定义一个用户对象，并在这里指定注册时要填写的信息，本例中只定义了用户名 `username` 和密码 `password`，需要指出的是，在不同系统里要求填写的信息可能不一样，考虑到找回密码的情况，一般还会要求填写邮箱等信息，但不管怎样，用户名（有的系统会把邮箱作为用户名）和密码都是必不可少的，这里为了简化问题没有加入邮箱填写，因为完整的邮箱注册还包括发送邮件验证邮箱正确性等步骤，而这些步骤跟本书要讲的内容没有直接关系。

```ts
// 定义一个 User 对象
export class User {
  constructor(
    public username: string,
    public password: string
  ) { }
}
```

+ user.service.ts

注册行为不可避免的要与后台通信，将数据处理抽象出来，作为一个 `service` 来管理前后台的通信，这样做的好处是：一、提升代码的可维护性，二、代码可测试。所以，在这个文件里可以看到，组件是如何与后台进行交互的。

+ user.validators.ts

顾名思义，这是对 User 的校验（validate），事实上，只要是表单，或多或少都涉及到校验，校验包括前端校验和后台校验，这里所说的的校验都是指前端校验，前端校验的好处很明显： 一方面可以提升用户体验，让用户知道该输入什么，哪里输错了；另一方面可以减少无效的提交，并且提高提交的成功率。
不管是从用户体验方面还是从成功率方面，校验都是必不可少的。

一般说来，浏览器原生就会支持部分校验，比如 `required` 和 `maxlength`。不过，原生提供的校验一般都不能满足需求，为此，我们还需要自定义一些校验规则，参考：

```ts
import {  Control } from '@angular/common';

// 定义 用户名 和 密码 的校验正则表达式
const REG = {
  USERNAME: /^\w{1,20}$/,
  PASSWORD: /^\w{6,20}$/
};

// 定义返回值的数据结构
interface ValidationResult {
  [key: string]: boolean;
}

export class UserValidators {
  // 用户名校验
  static username(control: Control): ValidationResult {
    if (REG.USERNAME.test(control.value)) {
      return null;
    }
    return { 'invalid': true };
  }
  // 密码校验
  static password(control: Control): ValidationResult {
    if (REG.PASSWORD.test(control.value)) {
      return null;
    }
    return { 'invalid': true };
  }
}
```

