## 1.2 Angular 简介

通过上一节的介绍，我们对近几年 Web 开发现状和潮流有了较为完整的认识。我们看见很多概念诸如 MVC，MVVM，Web Component，Flux，immutable data 纷纷进入我们的视野和慢慢融入到我们的开发实践中。在本章节，我们会正式进入 Angular 的讲解。看看这些开发实践和概念是怎么潜移默化影响 Angular，Angular 又是怎么引领一代开发风潮的。

我们首先对 Angular 的历史进行回顾，看看它怎么从个人项目 getAngular 转型为 Google 内部流行的官方项目，1.x各个版本迭代引入哪些特性，Angular2 是怎么一步步走进我们，甚至它的工具生态周边是怎么与它相辅相成。接着，我们对 Angular2 的主要特点进行简单概述，便于读者在后续章节的详细讲解前有个直观的全局认识。最后，我们在结尾给出本章的总结。

### 1.2.1 历史回顾

#### getAngular 起源

在2009年，AngularJS 被两位开发者（Misko Hevery and Adam Abrons）作为业余项目中创造了出来。起初，它叫做 GetAngular，用来让 Web 设计师来和前端和后端工程师来交互的端到端的设计开发工具。

Misko Hevery 随后在 Google 内接手 Google Feedback 的开发，在开发维护 Google Feedback 的6个月中，他和另外两位同事写了近1.7万行的代码。随着代码库变大，他们也遇到了维护开发的难题：在现有庞大代码库中修改添加代码变得举步维艰。

所以那时 Misko 开始找他老板，并打赌说他只需要两周的时间就用 GetAngular 重新整个反馈应用。事实上，他食言了！Misko 用了三周时间，把项目从原来的1.7万行代码精简到1500行代码。

Misko 引入实践 AngularJS 并且效果不错，引起了他老板 Brad Green 的注意，至此 AngularJS 就进入了开发快车道中。

最早的创始人 Adam Abrons 没有在继续开发 AngularJS。但 Misko Hevery 和他的经理还在继续，他们先把 GetAngular 项目改变为新的名叫 AngularJS 的，同时在 Google 内组建了团队专职来开发和维护它。

AngularJS 第一次在 Google 内部一鸣惊人是在 DoubleClick（刚被 Google 收购后）使用 AngularJS 非常高效重写了部分业务逻辑。看到 DoubleClick 的最初的成功实践，公司管理层觉得应该投入更多的人力和资源到 AngularJS 团队上，让他们集中精力开发 AngularJS 框架和周边，并且在公司内外作为产品开发，运营和推广。

#### 1.x 的迭代之路

在进入开发快车道后，AngularJS 的版本迭代有条不紊的进行了下来。

在2010年10月，发布 0.9.0 dragon-breath。一年后发布了 0.10.0 chicken-hands，其中彻底重写了 Scope 的实现，引入 `ng:cloak` 来隐藏未被 compile 的内容，给 scope 添加了事件系统等。

在2012年3月中，AngularJS 开始进入1.0.0 发行候选版，前前后后的12个rc历时3个月，才在6月中旬发布了 1.0.0 temporal-domination。它包括：

- 彻底重写了 $compile，支持了指令的语法，之前的 widget, attrWidget,directive整合为单一的指令概念
- 优化表单/输入控件/双向数据绑定，从而自定义的数据验证和格式化变得方便实施
- controller-scope 两者分离，从而controller可以单独创建 new，不耦合在一起

在 1.0 版本发布后，核心团队在接下来几个月采用了新的版本方式：

- 1.0.x 会持续只集成缺陷修复（从1.1.x分支导入的），在1.2发布前会作为主要分支被支持
- 1.1.x 在小版本迭代中继续开发新功能特性，修复缺陷和引入破坏性的改造
- 1.2.x 会基于最新的1.1.x的发布变成稳定版本（bugfix分支）

2013年11月，迟迟到来的1.2 timely-delivery 版本，给我们带来了如下的功能和调整：

- 安全性提升，SCE 严格上下文转意，改造 $compile
- 彻底重写的 transitions/animations 动画相关的支持
- 优化错误提示以便于调试
- 把 ngRoute 抽取到单独的模块中
- 引入 ControllerAs 语法，在模板中获取 controller 实例，区别 scope
- ngRepeat 支持 track by 函数来方式重复
- Promise A+ 标准支持

同时，Angular团队花了大量时间去优化，简化，提升文档质量和官方文档的浏览体验。

2014年的10月中旬，在 1.3 superluminal-nudge 版本中，AngularJS 宣布了不再继续支持 IE8。同时提供了如下的新功能：

- 单次绑定：在模板中使用 `::` 的表达式
- ngAria 该模板用于来提升视觉辅助
- ngMessages 该模块来更好做表单检验消息
- ng-model-options 对该ngModel更细粒度的控制

> 在同年的4月，微软宣布停止对 Windows XP 系统的支持，意味着不再支持主要运行于该系统上的IE8浏览器

透露于前一周的 ng-conf 大会，Angular 团队在15年5月底，官方终于方步发布了 1.4 jaracimrman-existence 版本。该版本中超过400个提交，优化了文档，修改了超过100个bug，新增超30个新特性。包括：

- 重写动画模块，从而提供了强大功能和钩子，大量的老bug也没了
- Router，为Angular 1和2 提供一个一致强大的路由方案
- i18n，完成一等公民化的i18n国际化
- 表单，解析/格式化/验证更容易和强健的表单控件方案
- HTTP，增强 $http 服务，提供序列化，JSON 解析，Mock 测试的领域语言 API
- $parse，解析服务的性能优化提升

在今年2月份，官方发布了1.5版本，该版本的主题就是要和Angular2做进一步整合，提供更接近于Angular2应用的书写体验。如组件式的开发，定义组件指令，生命周期钩子等等


#### 襁褓中的怪胎

在14年3月份，官方博客就有提及在为新 Angular 做设计和开发，所有的设计文档都公布在 Google 云盘中。博客宣称该框架是优先为移动应用设计，更快速的变化检测，模块化引入，新路由采用状态支持整合认证授权和缓存视图等，有持久化支持离线使用等等。大家为之兴奋不已！

随后在同年的9月下旬的 ng-Europe 大会上正式宣布。发布后，它宣称的戏剧性的接口和概念改变在很多 AngularJS 开发者引起了巨大的争议。

- 引入Component，整合统一了控制器和模板，向 WebComponent 标准看齐
- 引入 atScript，对 TypeScript 和 ES6 语法的增强，添加可选运行时类型和注解来帮助大型团队开发复杂应用和更好的文档化支持
- 移除 Scope 概念
- 使用新的路由等

这些大的改变抛弃了 AngularJS 这几年来的一些历史包袱，让经验老到的开发团队能够重新设计，结合老 Angular 的经验教训和外界引入的思潮（如 React 的日益流行，以 Virtual DOM 分离出的渲染来获得性能提升和平台扩展性，向 Web Component 的标准看齐和引入）。不过这些激进的转变让1.x的开发者感到不习惯，很多人开玩笑说『现在用 AngularJS 1.x 这个注定很快要淘汰的框架开发业务代码...』，但从长久看上看，尽管当时被各种抨击，但这个破釜沉舟的决定还是非常正确的，成就了 Angular2 现在的高性能，高开发效率，丰富扩展能力的特点。

在15年的4月30号，Angular 团队宣布它从最初的 alpha 版本转到开发者预览版中。

同时官方也先后引入了 ngUpgrade 和 ngForward，强调迁移和面向2.0的更新，让现在写的代码可以较为容易的升级到2.0。支持在现有的 Angular1.x 应用中集成 Angular2 等。

#### 新的勃勃生机

通过 alpha 版本和开发者预览版，Angular 团队和Google内部好几个大项目组的同事紧密配合，也在用真实项目需求在检验着Angular2，包括了 AdWords 广告团队, GreenTea 内部客户关系管理软件的团队，Google光纤团队。事实上，2015年底，Google 光纤产品上线背后的代码库就是以 Angular2 代码为基准的。

在2015年12月，Angular2 开始进入 beta 版本。好几个外部组开始整合新的 Angular2。如 Ionic 框架推出 ionic2 计划，Telerik 加紧对 NativeScript 的整合，Rangle.io 开发 Batarangle 开发者工具等。同时官网 Angular.io 上线，快速开始文档扩充了新的内容，入门教程和还有不少开发者指南被添加，参考手册等文章也被提供，开发者可以一步步体验和使用 Angular2 了。

在16年的5月，Angular2 正式开始进入发行候选rc阶段，代表着 Angular2 正式发布已经离我们不远了。
6月中旬发布rc2版本。

- 动画框架引入状态化书写的方式，底层支持多平台
- 表单提升，引入更清晰的指令和对象名称，包括ngModelGroup, FormGroup() 等
- 同时合入了超过100项社区贡献的代码，压缩了PR申请的队列

一周后，rc3版本发布。该版本把新路由项目合入主代码库中（但它仍然会保持自己的版本号和发布迭代周期。同时内容安全特性已经开发完毕和文档化了，新的表单案例文章也可供浏览了。


#### 开发语言之选

优秀框架的开发离不开强大编程语言，尤其像是 Angular 这样的大手笔。在 Angular 框架开发之路上，伴随过 Dart，atScript， TypeScript 这三门类 JavaScript。可以看到在严谨工程实现上，对语言的特性和功能的要求都是苛刻的。

Google 对语言的新投入上 Dart。它是 Google 开发用于替代JavaScript的编程语言，在Google内部通过把 Angular 用 Dart 重写来试用检验 Dart 语言。这个重写项目叫做 AngularDart。这是 Hevery 在14年一直在忙碌的项目。非常有意思的根据 Google 团队说，把 Angular 移植到到 Dart 上效果出乎意料的好，因为这让核心团队能够接触到很多新的好主意，最终又把它待会到 JavaScript 版本中（如 Zone.js等）

AtScript 是基于 JavaScript，并且扩展了微软的 TypeScript，最终转译到 JavaScript 的脚本语言。它最早在2014年的 ng-Europe 大会上被 Google AngularJS 核心开发人员宣布为后续 2.0 版本的主要构建语言。 起初 AtScript 被设计运行在 TypeScript 之上，同时从 Dart 引入一些新的有用的特性。

不过在2015年3月的盐湖城上，微软 TypeScript 和谷歌 Angular 开发团队一起宣布了会把 atScript 中不少新的特性功能在 TS 的1.5版本中发布，同时 Angular2 将仅仅用 TypeScript 来构建。


#### 工具周边和生态


从工具到平台，伴随着的是周边生态和相关工具的不断涌现和完善发展。

> Todo


### 1.2.2 Angular 简述

在本小节我们会进一步走进 Angular2，从它7大核心概念看背后的设计亮点，从它逐渐从框架到平台的演进中，看它的发展趋势。

#### Angular 核心概念

Angular 框架的核心理念有如下7个部分，对于普通的 Web 开发需要去学习和了解，它是驱动 Angular 的核心。

![](../_images/chapter1-2/14671890216871.jpg)


- 模块

在 Web 开发中，我们通过依赖全局状态/变量，和保证引入 JavaScript 文件顺序来正确加载我们的类库。像 $ 代表着 jQuery，当在引入 $.superAwesomeDatePicker 类库来实现日期选择控件前，需要确保 jQuery 已经正常载入。当我们应用越来越大，文件切分越来越细，需要一个成熟的模块系统（之前的AMD，CMD等）来帮忙我们管理依赖。在新的语言标准中，我们有了 imports，导入在其他文件中定义并且 exports 导出的诸如 jQuery 或 moment 这样的依赖到我们的业务代码模块中。后续的 TypeScript 章节中会对该语法进行更详细的讲解。还需要注意的特性是，新语言特性还给我们带来Class 类，Inherit 继承和 Annotation 注解（它为底层的 Angular 框架提供元数据信息）


- 组件

以组件为基础的架构模式是现在 Web 前端开发中的主流的方式。不仅仅在 Angular 中，在类似的 React，  Ember 或 Polymer 等框架中也是很常见的。这种开发方式就是构建职责定义清晰，可以在多个应用中被复用的自组织的代码单元。如使用 Google 地图组件，就在页面引入 `<google-mappointer="46.471089,11.332816"</google-map>` 这样语义化的标签。

Angular2 全面支持这样的开发方式，在 Angular 中，组件是第一等的公民。伴随组件而来的是组件树的概念。每个 Angular2的程序都有一个组件树，由应用组件或者叫顶层的根组件和许多子组件和兄弟组件组成。组件树是很重要的概念，后续章节还会继续讲解。它有很多作用，如它会展示出你的 UI 界面是怎么组成的，这样的结构图也体现了一个组件到另一个组件间的数据流动。Angular也依赖于此做改变检测的策略。

![](../_images/chapter1-2/14675631421653.jpg)


> 改变检测是 Angular 在应用的数据变化后，用于决定哪个组件需要随之刷新的机制。


- 模板和数据绑定

当我们使用组件标签的时候，当然需要在某处去定义让 Angular 渲染显示的内容。通过类似于 `template` 或 `templateUrl` 来用 HTML 标记语言来描述界面。
我们需要数据绑定机制来实现把数据映射到模板上或者从模板（如input控件）中取回数据。


- 服务和依赖注入

在 Angular2 中，如果说组件是用于处理界面和交互相关的，那么服务就是开发者用于书写和放置自己业务逻辑的地方。服务可以被共享从而被多个组件共同使用。一个服务就是一个简单的 ES6 的类。通常我们在组件中引用服务后使用它来处理数据和实现逻辑。那么我们在引用前，在哪里初始化它呢？
通过对实现服务的类加上 `@injection` 注解标注，同时把它注册为 provider 提供器（可以在应用，根组件，或需要注入服务的上层组件中实施）

### Angular 从框架到平台

Angular 的项目经理 Brad 说过 Angular2 现在更像是一个平台而不是简单的类库或者单一的框架。它从最早的大而全的代码切分为多个模块化的部分，并在此之上构建其他好用的工具。

![](../_images/chapter1-2/14671890495467.jpg)


框架核心的包含：

- 依赖注入
- 装饰器支持
- zone.js（可以独立于Angular使用在其他地方，并且现在已经提交TC39考虑进入ECMA的标准）
- 编译服务
- 变化检测
- 渲染引擎（平台独立，可以方便实施在可安装的桌面软件和原生移动客户端中）

在此之上还有不少外部工具库，其他类似于：

- Angular  Material（Material设计风格的UI组件库）
- Angular Mobile Toolkit（提供工具和技巧来开发高性能的移动移动）
- Angular Universal（实现后端渲染来加速首屏渲染和实现搜索引擎优化）等

除了这些外，Angular周边也有完善的工具体系：

- CLI提供了一套把工作流自动化从创建项目，到生成脚手架如组件，路由配置，启动开发服务器，生成测试脚手架，lint和格式化，运行测试，预处理CSS样式，部署前的构建等等
- 语言服务是由 Angular 采用 TypeScript 构建所以类似于在IDE中完善的代码补全，语法检查报错，定义跳转，方法提示等等，从而显著提升开发效率和编译运行前的错误发现
- Augury（之前叫 Batarangle）它是用于调试和性能分析的开发者工具，可视化查看应用的组件树和定位问题

当然为了开发强大应用，Angular 在功能开发上也提供了不少辅助模块。如：

- i18n 用于语言国际化，字符时间等本地化
- 用于构建多界面的 SPA 的路由系统（从两三年前一直跌到到现在破釜沉舟的3.0）
- 动画模块提供了基于声明式的书写体验和完善钩子节点的功能。

这些模板都是可以同时在1.x和2.0同时使用的，减少开发者的迁移成本。Angular2 和 AngularJS 1.x 不是孤立的，通过 ngUpgrade，ngForward 两个模块能够从今天在1.x开发的应用仓库中就立即使用上2.0的功能，面向未来编码。

### Angular 特点

我们先后看了 Angular 核心概念和 Angular 平台提供的各式各样的功能，那么 Angular 相对于其他前端技术有什么特点呢？

它拥有超快的性能：

- 渲染速度优化，包括更快的变化检测，内部的性能基准测试框架
- 视图缓存从而实现流畅的虚拟滚动和丝滑的页面切换。
- 通过服务端渲染实现更快的首屏加载，更小的启动库网络加载更快
- 更好的响应性在移动端上（原生支持各种手势，触摸等

![](../_images/chapter1-2/14671891035727.jpg)

它对开发支持更完善：

- 提供的 CLI 帮助开发更快脚手架和流畅的开发工作流
- 通过 augury 可视化的查看应用状态和 Angular 内部
- 通过 TypeScript 使得严肃工程化编程得以实施
- 官方支持的代码风格向导和检查 - lint/style 工具

![](../_images/chapter1-2/14671891897009.jpg)

它的社区和周边也强大多样：

- 官方级别的 Material Design 和其他UI库
- 可以通过 mobile toolkit，ionic2，nativescript/react native 开发h5，混合应用和原生应用
- 结合Meteor，实现全栈式开发和高效整合。

这就是你应该立即应该用上 Angular2 的原因了！


### 1.2.3 小结

通过本章的学习，我们对 Angular 有了较为直观的认识。清楚了它历史发展的一步步轨迹，也明白了 Angular2 这个怪胎成长为根正苗红欣欣向荣的大平台的故事。Angular 的内核包括了模块，组件，模板数据绑定，服务，依赖注入，注解等这些概念来实施应用开发，它的平台也提供了各种辅助周边，功能模块，效率开发工具等，最终形成了我们性能强劲快速，开发体验完善，社区和周边强大的 Angular2。

在下一章，我们会学习 TypeScript 语言，它是构建 Angular 框架的基石语言，也是官方推荐的开发语言。那么，我们继续吧~

